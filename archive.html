---
layout: default
title: Comic Archive
permalink: /archive/
---

<div class="archive-page">
    <h1>Comic Archive</h1>

    <div class="archive-controls">

        <!-- Text Search -->
        <div class="archive-search-row">
            <input type="text" id="search-box" placeholder="Search by title or tag...">
            <div class="archive-sort">
                <label for="sort-select">Sort:</label>
                <select id="sort-select" class="sort-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title-az">Title (A-Z)</option>
                    <option value="title-za">Title (Z-A)</option>
                </select>
            </div>
        </div>

        <!-- Visual Calendar -->
        <div class="archive-calendar-grid">
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prev-month">‹</button>
                <h3 class="calendar-month-title" id="calendar-title">December 2024</h3>
                <button class="calendar-nav-btn" id="next-month">›</button>
            </div>
            <div class="calendar-weekdays">
                <span>Sun</span>
                <span>Mon</span>
                <span>Tue</span>
                <span>Wed</span>
                <span>Thu</span>
                <span>Fri</span>
                <span>Sat</span>
            </div>
            <div class="calendar-days" id="calendar-days">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <!-- Episode Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">All Comics</button>
            {% assign all_episodes = site.comics | map: "episode" | uniq %}
            {% for episode in all_episodes %}
                <button class="filter-btn" data-filter="{{ episode | slugify }}">{{ episode }}</button>
            {% endfor %}
        </div>

    </div>

    <!-- Results count -->
    <p class="archive-results-count" id="results-count"></p>

    <div class="archive-grid">
        {% assign sorted_comics = site.comics | where: "published", true | sort: "date" | reverse %}
        {% for comic in sorted_comics %}
        <div class="archive-item"
             data-episode="{{ comic.episode | slugify }}"
             data-tags="{{ comic.tags | join: ' ' | downcase }}"
             data-title="{{ comic.title | downcase }}"
             data-year="{{ comic.date | date: '%Y' }}"
             data-month="{{ comic.date | date: '%m' }}">
            <a href="{{ comic.url }}">
                <div class="archive-thumbnail">
                    <img src="{{ comic.image }}" alt="{{ comic.title }}" loading="lazy">
                    <div class="archive-overlay">
                        <span>#{{ comic.comic_number }}</span>
                    </div>
                </div>
                <div class="archive-info">
                    <h3>{{ comic.title }}</h3>
                    <p class="archive-date">{{ comic.date | date: "%b %d, %Y" }}</p>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <div class="archive-no-results" id="no-results" style="display:none;">
        <p>No comics found. Try a different search or filter.</p>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchBox       = document.getElementById('search-box');
    const sortSelect      = document.getElementById('sort-select');
    const filterButtons   = document.querySelectorAll('.filter-btn');
    const archiveGrid     = document.querySelector('.archive-grid');
    const archiveItems    = document.querySelectorAll('.archive-item');
    const resultsCount    = document.getElementById('results-count');
    const noResults       = document.getElementById('no-results');
    const calendarDays    = document.getElementById('calendar-days');
    const calendarTitle   = document.getElementById('calendar-title');
    const prevMonthBtn    = document.getElementById('prev-month');
    const nextMonthBtn    = document.getElementById('next-month');

    let currentFilter = 'all';
    let currentDate = new Date();
    let selectedDate = null;

    // Build a map of dates that have comics
    const comicDates = new Set();
    archiveItems.forEach(item => {
        const year = item.dataset.year;
        const month = item.dataset.month;
        comicDates.add(`${year}-${month}`);
    });

    // Episode filter buttons
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            filterButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter;
            applyFilters();
        });
    });

    // Text search
    searchBox.addEventListener('input', applyFilters);

    // Sort select
    sortSelect.addEventListener('change', applySorting);

    // Calendar navigation
    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    function applySorting() {
        const sortValue = sortSelect.value;
        const itemsArray = Array.from(archiveItems);
        
        itemsArray.sort((a, b) => {
            switch(sortValue) {
                case 'newest':
                    // Sort by date descending (newest first)
                    return new Date(b.dataset.year + '-' + b.dataset.month) - 
                           new Date(a.dataset.year + '-' + a.dataset.month);
                
                case 'oldest':
                    // Sort by date ascending (oldest first)
                    return new Date(a.dataset.year + '-' + a.dataset.month) - 
                           new Date(b.dataset.year + '-' + b.dataset.month);
                
                case 'title-az':
                    // Sort by title A-Z
                    return a.dataset.title.localeCompare(b.dataset.title);
                
                case 'title-za':
                    // Sort by title Z-A
                    return b.dataset.title.localeCompare(a.dataset.title);
                
                default:
                    return 0;
            }
        });
        
        // Re-append items in sorted order
        itemsArray.forEach(item => archiveGrid.appendChild(item));
        
        // Reapply filters to maintain visibility
        applyFilters();
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        // Update title
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        calendarTitle.textContent = `${monthNames[month]} ${year}`;

        // Get first day of month and number of days
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // Clear calendar
        calendarDays.innerHTML = '';

        // Add empty cells for days before month starts
        for (let i = 0; i < firstDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day empty';
            calendarDays.appendChild(emptyDay);
        }

        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const dayEl = document.createElement('button');
            dayEl.className = 'calendar-day';
            dayEl.textContent = day;
            
            const dateKey = `${year}-${String(month + 1).padStart(2, '0')}`;
            const hasComic = comicDates.has(dateKey);
            
            if (hasComic) {
                dayEl.classList.add('has-comic');
                dayEl.addEventListener('click', () => selectDate(year, month + 1));
            } else {
                dayEl.classList.add('no-comic');
                dayEl.disabled = true;
            }

            // Highlight selected date
            if (selectedDate && 
                selectedDate.year === year && 
                selectedDate.month === month + 1) {
                dayEl.classList.add('selected');
            }

            calendarDays.appendChild(dayEl);
        }
    }

    function selectDate(year, month) {
        if (selectedDate && selectedDate.year === year && selectedDate.month === month) {
            // Deselect if clicking same month again
            selectedDate = null;
        } else {
            selectedDate = { year, month };
        }
        renderCalendar();
        applyFilters();
    }

    function applyFilters() {
        const searchTerm = searchBox.value.toLowerCase().trim();
        let visibleCount = 0;

        archiveItems.forEach(item => {
            const title   = item.dataset.title;
            const tags    = item.dataset.tags;
            const episode = item.dataset.episode;
            const year    = item.dataset.year;
            const month   = item.dataset.month;

            const matchesSearch   = !searchTerm || title.includes(searchTerm) || tags.includes(searchTerm);
            const matchesEpisode  = currentFilter === 'all' || episode === currentFilter;
            const matchesDate     = !selectedDate || 
                                   (year === String(selectedDate.year) && 
                                    month === String(selectedDate.month).padStart(2, '0'));

            const visible = matchesSearch && matchesEpisode && matchesDate;
            item.style.display = visible ? 'block' : 'none';
            if (visible) visibleCount++;
        });

        // Update results count
        const total = archiveItems.length;
        if (visibleCount === total) {
            resultsCount.textContent = '';
        } else {
            resultsCount.textContent = visibleCount + ' of ' + total + ' comics shown';
        }

        // Show/hide no results message
        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // Initial render
    renderCalendar();
});
</script>
