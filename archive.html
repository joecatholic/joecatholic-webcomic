---
layout: default
title: Comic Archive
permalink: /archive/
---

<div class="archive-page">
    <h1>Comic Archive</h1>

    <div class="archive-controls">

        <!-- Text Search -->
        <div class="archive-search-row">
            <input type="text" id="search-box" placeholder="Search by title or tag...">
            <div class="archive-sort">
                <label for="sort-select">Sort:</label>
                <select id="sort-select" class="sort-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title-az">Title (A-Z)</option>
                    <option value="title-za">Title (Z-A)</option>
                </select>
            </div>
        </div>

        <!-- Year/Month Accordion -->
        <div class="archive-accordion">
            <div class="accordion-header">
                <span class="accordion-icon">ðŸ“…</span>
                <span class="accordion-label">Browse by Date</span>
                <button class="accordion-toggle" id="accordion-toggle">â–¼</button>
            </div>
            <div class="accordion-content" id="accordion-content">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <!-- Episode Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all" id="all-comics-btn">All Comics</button>
            {% assign all_episodes = site.comics | where: "published", true | map: "episode" | uniq %}
            {% for episode in all_episodes %}
                <button class="filter-btn" data-filter="{{ episode | slugify }}">{{ episode }}</button>
            {% endfor %}
            <button class="filter-btn reset-btn" id="reset-btn">âœ• Reset All Filters</button>
        </div>

    </div>

    <!-- Results count -->
    <p class="archive-results-count" id="results-count"></p>

    <div class="archive-grid">
        {% assign sorted_comics = site.comics | where: "published", true | sort: "date" | reverse %}
        {% for comic in sorted_comics %}
        <div class="archive-item"
             data-episode="{{ comic.episode | slugify }}"
             data-tags="{{ comic.tags | join: ' ' | downcase }}"
             data-title="{{ comic.title | downcase }}"
             data-year="{{ comic.date | date: '%Y' }}"
             data-month="{{ comic.date | date: '%m' }}"
             data-day="{{ comic.date | date: '%d' }}">
            <a href="{{ comic.url }}">
                <div class="archive-thumbnail">
                    <img src="/assets/thumbnails/{{ comic.image | split: '/' | last }}" alt="{{ comic.title }}" loading="lazy">
                    <div class="archive-overlay">
                        <span>#{{ comic.comic_number }}</span>
                    </div>
                </div>
                <div class="archive-info">
                    <h3>{{ comic.title }}</h3>
                    <p class="archive-date">{{ comic.date | date: "%b %d, %Y" }}</p>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <div class="archive-no-results" id="no-results" style="display:none;">
        <p>No comics found. Try a different search or filter.</p>
    </div>

</div>

<script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchBox         = document.getElementById('search-box');
    const sortSelect        = document.getElementById('sort-select');
    const filterButtons     = document.querySelectorAll('.filter-btn');
    const archiveGrid       = document.querySelector('.archive-grid');
    const archiveItems      = document.querySelectorAll('.archive-item');
    const resultsCount      = document.getElementById('results-count');
    const noResults         = document.getElementById('no-results');
    const accordionContent  = document.getElementById('accordion-content');
    const accordionToggle   = document.getElementById('accordion-toggle');
    const resetBtn          = document.getElementById('reset-btn');
    const allComicsBtn      = document.getElementById('all-comics-btn');

    let currentFilter = 'all';
    let selectedYearMonth = null;

    // Build comics by year/month structure
    const comicsByYearMonth = {};
    archiveItems.forEach(item => {
        const year = item.dataset.year;
        const month = item.dataset.month;
        const day = item.dataset.day;
        
        if (!comicsByYearMonth[year]) {
            comicsByYearMonth[year] = {};
        }
        if (!comicsByYearMonth[year][month]) {
            comicsByYearMonth[year][month] = [];
        }
        
        comicsByYearMonth[year][month].push({
            title: item.dataset.title,
            url: item.querySelector('a').href,
            thumbnail: item.querySelector('.archive-thumbnail img')?.src || '',
            number: item.querySelector('.archive-overlay')?.textContent || '',
            day: day
        });
    });

    // Episode filter buttons
    filterButtons.forEach(btn => {
        if (btn.id === 'reset-btn') return; // handled separately
        btn.addEventListener('click', function() {
            filterButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter || 'all';
            // "All Comics" also clears date selection and search
            if (this.id === 'all-comics-btn') {
                resetAll();
            } else {
                applyFilters();
            }
        });
    });

    // Reset button
    resetBtn.addEventListener('click', resetAll);

    // Text search
    searchBox.addEventListener('input', applyFilters);

    // Sort select
    sortSelect.addEventListener('change', applySorting);

    function resetAll() {
        // Clear search box
        searchBox.value = '';

        // Reset episode filter to All Comics
        currentFilter = 'all';
        filterButtons.forEach(b => b.classList.remove('active'));
        allComicsBtn.classList.add('active');

        // Clear date selection
        selectedYearMonth = null;
        document.querySelectorAll('.month-btn').forEach(b => b.classList.remove('selected'));
        document.querySelectorAll('.year-header').forEach(h => h.classList.remove('active'));
        document.querySelectorAll('.months-list').forEach(m => m.classList.remove('open'));

        // Reset sort to newest first
        sortSelect.value = 'newest';
        applySorting(); // re-sort then filter
    }

    // Accordion toggle
    accordionToggle.addEventListener('click', function() {
        const content = accordionContent;
        const isOpen = content.classList.contains('open');
        
        if (isOpen) {
            content.classList.remove('open');
            this.textContent = 'â–¼';
        } else {
            content.classList.add('open');
            this.textContent = 'â–²';
        }
    });

    function buildAccordion() {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        
        const years = Object.keys(comicsByYearMonth).sort().reverse();
        
        accordionContent.innerHTML = '';
        
        years.forEach(year => {
            const yearSection = document.createElement('div');
            yearSection.className = 'year-section';
            
            const yearHeader = document.createElement('button');
            yearHeader.className = 'year-header';
            yearHeader.textContent = year;
            yearHeader.onclick = function() {
                const monthsDiv = this.nextElementSibling;
                const isOpen = monthsDiv.classList.contains('open');
                
                // Close all other year sections
                document.querySelectorAll('.months-list').forEach(m => m.classList.remove('open'));
                document.querySelectorAll('.year-header').forEach(h => h.classList.remove('active'));
                
                if (!isOpen) {
                    monthsDiv.classList.add('open');
                    this.classList.add('active');
                }
            };
            
            const monthsList = document.createElement('div');
            monthsList.className = 'months-list';
            
            const months = Object.keys(comicsByYearMonth[year]).sort((a, b) => parseInt(b) - parseInt(a));
            
            months.forEach(month => {
                const monthNum = parseInt(month);
                const count = comicsByYearMonth[year][month].length;
                
                const monthBtn = document.createElement('button');
                monthBtn.className = 'month-btn';
                monthBtn.innerHTML = `${monthNames[monthNum - 1]} <span class="month-count">(${count})</span>`;
                monthBtn.onclick = function() {
                    // Toggle selection
                    if (selectedYearMonth && selectedYearMonth.year === year && selectedYearMonth.month === month) {
                        selectedYearMonth = null;
                        this.classList.remove('selected');
                    } else {
                        // Remove previous selection
                        document.querySelectorAll('.month-btn').forEach(b => b.classList.remove('selected'));
                        selectedYearMonth = { year, month };
                        this.classList.add('selected');
                    }
                    applyFilters();
                };
                
                // Add tooltip with comic previews
                const tooltip = document.createElement('div');
                tooltip.className = 'month-tooltip';
                
                comicsByYearMonth[year][month].slice(0, 3).forEach(comic => {
                    const preview = document.createElement('div');
                    preview.className = 'tooltip-preview';
                    
                    if (comic.thumbnail) {
                        const img = document.createElement('img');
                        img.src = comic.thumbnail;
                        img.alt = comic.title;
                        preview.appendChild(img);
                    }
                    
                    const info = document.createElement('div');
                    info.className = 'tooltip-info';
                    info.textContent = `${comic.number} ${comic.title}`;
                    preview.appendChild(info);
                    
                    tooltip.appendChild(preview);
                });
                
                if (comicsByYearMonth[year][month].length > 3) {
                    const more = document.createElement('div');
                    more.className = 'tooltip-more';
                    more.textContent = `+${comicsByYearMonth[year][month].length - 3} more`;
                    tooltip.appendChild(more);
                }
                
                monthBtn.appendChild(tooltip);
                monthsList.appendChild(monthBtn);
            });
            
            yearSection.appendChild(yearHeader);
            yearSection.appendChild(monthsList);
            accordionContent.appendChild(yearSection);
        });
    }

    function applySorting() {
        const sortValue = sortSelect.value;
        const itemsArray = Array.from(archiveItems);
        
        itemsArray.sort((a, b) => {
            switch(sortValue) {
                case 'newest':
                    return new Date(b.dataset.year + '-' + b.dataset.month + '-' + b.dataset.day) - 
                           new Date(a.dataset.year + '-' + a.dataset.month + '-' + a.dataset.day);
                
                case 'oldest':
                    return new Date(a.dataset.year + '-' + a.dataset.month + '-' + a.dataset.day) - 
                           new Date(b.dataset.year + '-' + b.dataset.month + '-' + b.dataset.day);
                
                case 'title-az':
                    return a.dataset.title.localeCompare(b.dataset.title);
                
                case 'title-za':
                    return b.dataset.title.localeCompare(a.dataset.title);
                
                default:
                    return 0;
            }
        });
        
        itemsArray.forEach(item => archiveGrid.appendChild(item));
        applyFilters();
    }

    function applyFilters() {
        const searchTerm = searchBox.value.toLowerCase().trim();
        let visibleCount = 0;

        archiveItems.forEach(item => {
            const title   = item.dataset.title;
            const tags    = item.dataset.tags;
            const episode = item.dataset.episode;
            const year    = item.dataset.year;
            const month   = item.dataset.month;

            const matchesSearch      = !searchTerm || title.includes(searchTerm) || tags.includes(searchTerm);
            const matchesEpisode     = currentFilter === 'all' || episode === currentFilter;
            const matchesYearMonth   = !selectedYearMonth || 
                                      (year === selectedYearMonth.year && month === selectedYearMonth.month);

            const visible = matchesSearch && matchesEpisode && matchesYearMonth;
            item.style.display = visible ? 'block' : 'none';
            if (visible) visibleCount++;
        });

        const total = archiveItems.length;
        if (visibleCount === total) {
            resultsCount.textContent = '';
        } else {
            resultsCount.textContent = visibleCount + ' of ' + total + ' comics shown';
        }

        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // Initialize
    buildAccordion();
});
</script>
