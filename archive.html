---
layout: default
title: Comic Archive
permalink: /archive/
---

<div class="archive-page">
    <h1>Comic Archive</h1>

    <div class="archive-controls">

        <!-- Text Search -->
        <div class="archive-search-row">
            <input type="text" id="search-box" placeholder="Search by title or tag...">
            <div class="archive-sort">
                <label for="sort-select">Sort:</label>
                <select id="sort-select" class="sort-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title-az">Title (A-Z)</option>
                    <option value="title-za">Title (Z-A)</option>
                </select>
            </div>
        </div>

        <!-- Visual Calendar -->
        <div class="archive-calendar-grid">
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prev-month">‹</button>
                <h3 class="calendar-month-title" id="calendar-title">December 2024</h3>
                <button class="calendar-nav-btn" id="next-month">›</button>
            </div>
            <div class="calendar-weekdays">
                <span>Sun</span>
                <span>Mon</span>
                <span>Tue</span>
                <span>Wed</span>
                <span>Thu</span>
                <span>Fri</span>
                <span>Sat</span>
            </div>
            <div class="calendar-days" id="calendar-days">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <!-- Episode Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">All Comics</button>
            {% assign all_episodes = site.comics | map: "episode" | uniq %}
            {% for episode in all_episodes %}
                <button class="filter-btn" data-filter="{{ episode | slugify }}">{{ episode }}</button>
            {% endfor %}
        </div>

    </div>

    <!-- Results count -->
    <p class="archive-results-count" id="results-count"></p>

    <div class="archive-grid">
        {% assign sorted_comics = site.comics | where: "published", true | sort: "date" | reverse %}
        {% for comic in sorted_comics %}
        <div class="archive-item"
             data-episode="{{ comic.episode | slugify }}"
             data-tags="{{ comic.tags | join: ' ' | downcase }}"
             data-title="{{ comic.title | downcase }}"
             data-year="{{ comic.date | date: '%Y' }}"
             data-month="{{ comic.date | date: '%m' }}"
             data-day="{{ comic.date | date: '%d' }}">
            <a href="{{ comic.url }}">
                <div class="archive-thumbnail">
                    <img src="{{ comic.image }}" alt="{{ comic.title }}" loading="lazy">
                    <div class="archive-overlay">
                        <span>#{{ comic.comic_number }}</span>
                    </div>
                </div>
                <div class="archive-info">
                    <h3>{{ comic.title }}</h3>
                    <p class="archive-date">{{ comic.date | date: "%b %d, %Y" }}</p>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <div class="archive-no-results" id="no-results" style="display:none;">
        <p>No comics found. Try a different search or filter.</p>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchBox       = document.getElementById('search-box');
    const sortSelect      = document.getElementById('sort-select');
    const filterButtons   = document.querySelectorAll('.filter-btn');
    const archiveGrid     = document.querySelector('.archive-grid');
    const archiveItems    = document.querySelectorAll('.archive-item');
    const resultsCount    = document.getElementById('results-count');
    const noResults       = document.getElementById('no-results');
    const calendarDays    = document.getElementById('calendar-days');
    const calendarTitle   = document.getElementById('calendar-title');
    const prevMonthBtn    = document.getElementById('prev-month');
    const nextMonthBtn    = document.getElementById('next-month');

    let currentFilter = 'all';
    let currentDate = new Date();
    let selectedDate = null;

    // Build a map of dates with comic details
    const comicsByDate = {};
    archiveItems.forEach(item => {
        const year = item.dataset.year;
        const month = item.dataset.month;
        const day = item.dataset.day;
        const dateKey = `${year}-${month}-${day}`;
        
        if (!comicsByDate[dateKey]) {
            comicsByDate[dateKey] = [];
        }
        
        comicsByDate[dateKey].push({
            title: item.dataset.title,
            url: item.querySelector('a').href,
            thumbnail: item.querySelector('.archive-thumbnail img')?.src || '',
            number: item.querySelector('.archive-overlay')?.textContent || ''
        });
    });

    // Episode filter buttons
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            filterButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter;
            applyFilters();
        });
    });

    // Text search
    searchBox.addEventListener('input', applyFilters);

    // Sort select
    sortSelect.addEventListener('change', applySorting);

    // Calendar navigation
    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    function applySorting() {
        const sortValue = sortSelect.value;
        const itemsArray = Array.from(archiveItems);
        
        itemsArray.sort((a, b) => {
            switch(sortValue) {
                case 'newest':
                    return new Date(b.dataset.year + '-' + b.dataset.month + '-' + b.dataset.day) - 
                           new Date(a.dataset.year + '-' + a.dataset.month + '-' + a.dataset.day);
                
                case 'oldest':
                    return new Date(a.dataset.year + '-' + a.dataset.month + '-' + a.dataset.day) - 
                           new Date(b.dataset.year + '-' + b.dataset.month + '-' + b.dataset.day);
                
                case 'title-az':
                    return a.dataset.title.localeCompare(b.dataset.title);
                
                case 'title-za':
                    return b.dataset.title.localeCompare(a.dataset.title);
                
                default:
                    return 0;
            }
        });
        
        itemsArray.forEach(item => archiveGrid.appendChild(item));
        applyFilters();
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        calendarTitle.textContent = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        calendarDays.innerHTML = '';

        // Empty cells before month starts
        for (let i = 0; i < firstDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day empty';
            calendarDays.appendChild(emptyDay);
        }

        // Days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const comics = comicsByDate[dateKey] || [];
            
            if (comics.length > 0) {
                // Day with comic(s) - create as link
                const dayLink = document.createElement('a');
                dayLink.className = 'calendar-day has-comic';
                dayLink.href = comics[0].url;  // Link to first comic of the day
                dayLink.textContent = day;
                
                // Create tooltip with comic info
                const tooltip = document.createElement('div');
                tooltip.className = 'calendar-tooltip';
                
                comics.forEach(comic => {
                    const comicPreview = document.createElement('div');
                    comicPreview.className = 'calendar-comic-preview';
                    
                    if (comic.thumbnail) {
                        const img = document.createElement('img');
                        img.src = comic.thumbnail;
                        img.alt = comic.title;
                        comicPreview.appendChild(img);
                    }
                    
                    const title = document.createElement('div');
                    title.className = 'calendar-comic-title';
                    title.textContent = `#${comic.number} ${comic.title}`;
                    comicPreview.appendChild(title);
                    
                    tooltip.appendChild(comicPreview);
                });
                
                dayLink.appendChild(tooltip);
                calendarDays.appendChild(dayLink);
            } else {
                // Day without comic
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day no-comic';
                dayEl.textContent = day;
                calendarDays.appendChild(dayEl);
            }
        }
    }

    function selectDate(year, month) {
        if (selectedDate && selectedDate.year === year && selectedDate.month === month) {
            selectedDate = null;
        } else {
            selectedDate = { year, month };
        }
        renderCalendar();
        applyFilters();
    }

    function applyFilters() {
        const searchTerm = searchBox.value.toLowerCase().trim();
        let visibleCount = 0;

        archiveItems.forEach(item => {
            const title   = item.dataset.title;
            const tags    = item.dataset.tags;
            const episode = item.dataset.episode;
            const year    = item.dataset.year;
            const month   = item.dataset.month;

            const matchesSearch   = !searchTerm || title.includes(searchTerm) || tags.includes(searchTerm);
            const matchesEpisode  = currentFilter === 'all' || episode === currentFilter;
            const matchesDate     = !selectedDate || 
                                   (year === String(selectedDate.year) && 
                                    month === String(selectedDate.month).padStart(2, '0'));

            const visible = matchesSearch && matchesEpisode && matchesDate;
            item.style.display = visible ? 'block' : 'none';
            if (visible) visibleCount++;
        });

        const total = archiveItems.length;
        if (visibleCount === total) {
            resultsCount.textContent = '';
        } else {
            resultsCount.textContent = visibleCount + ' of ' + total + ' comics shown';
        }

        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // Initial render
    renderCalendar();
});
</script>
